[buildout]
extends =

parts +=
    instance-debug
    zeoserver
    instance2
    instance3
    instance4
    instance-amqp

[zeoserver]
recipe = plone.recipe.zeoserver
zeo-address = ${port:zeo}
pack-days = 7
pack-keep-old = false
monitor-address = ${port:zeo-monitor}
zeo-conf-additional =
  %define FILESTORAGE ${buildout:directory}/var/filestorage
  %define BLOBSTORAGE ${buildout:directory}/var/blobstorage
  %include ${buildout:directory}/zeo_add.conf

[zope-conf]
additional =
  extensions ${buildout:directory}/Extensions
  %define ZEOADDRESS ${zeoserver:zeo-address}
  %define ZEOINSTANCE ${buildout:directory}/parts/zeoserver/var
  %define BLOBSTORAGE ${buildout:directory}/var/blobstorage
  %include ${buildout:directory}/zope_add_zeo.conf

[instance1]
recipe = plone.recipe.zope2instance
zeo-client = true
zeo-address = ${zeoserver:zeo-address}
zodb-cache-size = 5000
zeo-client-cache-size = 300MB
shared-blob = on
zope-conf-additional =
  <product-config five.z2monitor>
     bind 0.0.0.0:${port:instance1-monitor}
  </product-config>
  ${zope-conf:additional}

[instance2]
<= instance1
http-address = ${port:instance2-http}
zope-conf-additional = 
  <product-config five.z2monitor>
     bind 0.0.0.0:${port:instance2-monitor}
  </product-config>
  ${zope-conf:additional}

[instance3]
<= instance1
http-address = ${port:instance3-http}
zope-conf-additional = 
  <product-config five.z2monitor>
     bind 0.0.0.0:${port:instance3-monitor}
  </product-config>
  ${zope-conf:additional}

[instance4]
<= instance1
http-address = ${port:instance4-http}
zope-conf-additional = 
  <product-config five.z2monitor>
     bind 0.0.0.0:${port:instance4-monitor}
  </product-config>
  ${zope-conf:additional}

[instance-debug]
<= instance1
eggs =
    ${instance1:eggs}
    ${debug:eggs}
zcml =
    ${instance1:zcml}
    ${debug:zcml}
http-address = ${port:instance-debug-http}
debug-mode = on
verbose-security = on
zope-conf-additional = 
  <product-config five.z2monitor>
     bind 0.0.0.0:${port:instance-debug-monitor}
  </product-config>
  ${zope-conf:additional}

[instance-amqp]
<= instance1
zserver-threads = 1
eggs =
    ${instance1:eggs}
    imio.dms.amqp
zcml =
    ${instance1:zcml}
    imio.dms.amqp
http-address = ${port:instance-amqp-http}
zope-conf-additional = 
  <product-config five.z2monitor>
     bind 0.0.0.0:${port:instance-amqp-monitor}
  </product-config>
  ${zope-conf:additional}
  ${zope-conf:amqp}

[standard]
zeoserver = zeoserver
